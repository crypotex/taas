{% load i18n %}
{% csrf_token %}
{% load staticfiles %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <title>{% block title %}{% trans 'Tartu Agility Playground' %}{% endblock title %}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/sweetalert.css' %}">

    {% block styles %}{% endblock styles %}

    <script src="{% static 'js/jquery/jquery-2.1.4.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/ajax_setup.js' %}"></script>
    <script src="{% static 'js/sweetalert.min.js' %}"></script>

    {% block scripts %}{% endblock scripts %}

    <script type="text/javascript" src="{% static 'js/calendar.js' %}"></script>
    <script type="text/javascript">
        expireMessage = "{% trans 'Your reservation time has expired.' %}";
        var warningMessage = "{% trans 'Warning' %}";
        {% if user.is_authenticated %}
            getExpireDate();
            setTimeout(function () {
                console.log("Date reloaded: " + expire_date);
                if (expire_date == "Invalid Date" || expire_date == null) {
                    console.log("Ei ole date");
                    document.getElementById('timerMessage').style.visibility = "hidden";
                }
                else {
                    document.getElementById('timerMessage').style.visibility = "visible";
                }
            }, 100);
        {% endif %}
    </script>
    <script type="text/javascript" src="{% static 'js/countdown/jquery.countdown.js' %}"></script>

</head>

<body>
<div id="innerwrap">
    <header>
        <div id="headernav">
            <div class="logo">
                <a href="http://taas.ee/"><img alt="Tartu Agility Arenguselts" src="{% static 'img/logo.jpg' %}"></a>
            </div>
            <div class="navsmall">
                <a href="https://www.facebook.com/pages/Tartu-Agility-Arenguselts/626675224051536?ref=hl&amp;bookmark_t=page">
                    <img alt="Facebooki logo" src="{% static 'img/fblogo.png' %}"></a>
            </div>
            <div class="nav">
                <ul>
                    <li>
                        <a href="/">{% trans 'back to booking' %}</a>
                    </li>
                </ul>
            </div>
        </div>
        {% block nav %}
            {% if not user.is_authenticated %}
                <div class="user-nav">
                    <ul>
                        <li><a href="/user/login">{% trans 'Login' %}</a></li>
                        <li><a href="/user/register">{% trans 'Register' %}</a></li>
                    </ul>
                </div>
            {% else %}
                <div class="user-nav">
                    <ul>
                        <li>{% trans 'Hello, ' %}<a href="/user/update">{{ user.get_short_name }}</a></li>
                        <li><a id="budget" href="/user/balance">{{ user.display_budget_money }}</a></li>
                        <li><a href="/user/logout">{% trans 'Logout' %}</a></li>
                    </ul>
                </div>
            {% endif %}
        {% endblock nav %}
    </header>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                {% if message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
                    <script>
                        swal({title: warningMessage, text: "{{ message }}", type: "warning", customClass: "alert-button"});
                    </script>
                {% else %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endif %}
            {% endfor %}
        </ul>
    {% endif %}

    <div class="wrap">
        {% block tab-menu %}{% endblock tab-menu %}
        {% if user.is_authenticated %}
            <div id="timerMessage">{% trans 'To make all your reservations you have' %}
                <span id="timer"></span>
                {% trans 'minutes' %}
            </div>
        {% endif %}

        {% block content %}{% endblock content %}
    </div>

</div>
<form action="{% url 'set_language' %}" method="post">
    {% csrf_token %}
    <input name="next" type="hidden" value="{{ redirect_to }}"/>
    <select name="language">
        {% get_language_info_list for LANGUAGES as languages %}
        {% for language in languages %}
            <option value="{{ language.code }}"{% if language.code == LANGUAGE_CODE %}
                    selected="selected"{% endif %}>
                {{ language.name_local }} ({{ language.code }})
            </option>
        {% endfor %}
    </select>
    <input id="select_language" type="submit" value="Go"/>
</form>
</body>
</html>